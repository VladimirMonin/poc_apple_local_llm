# –û—Ç—á–µ—Ç: –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ all-MiniLM-L6-v2-4bit –≤–º–µ—Å—Ç–æ BGE-M3

**–î–∞—Ç–∞:** 8 –¥–µ–∫–∞–±—Ä—è 2025 –≥.  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–µ—Å—Ç `tests/02_test_embeddings_bge_m3.py`

---

## –ü—Ä–æ–±–ª–µ–º–∞

–í `poc_plan.md` (—Ä–∞–∑–¥–µ–ª 1.2) –±—ã–ª–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ **BGE-M3** (`BAAI/bge-m3`):

> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É `mlx-embeddings` –∏–ª–∏ –ø–æ—Ä—Ç `mlx-lm` [feature extraction].  
> –ó–∞–≥—Ä—É–∑–∏—Ç—å `BAAI/bge-m3` [–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ 8-bit –∏–ª–∏ 4-bit, —á—Ç–æ–±—ã —É–ª–æ–∂–∏—Ç—å—Å—è –≤ 0.6 –ì–ë]

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **all-MiniLM-L6-v2-4bit** (`mlx-community/all-MiniLM-L6-v2-4bit`).

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ BGE-M3

```
üîç –ü–æ–∏—Å–∫ BGE-M3 –≤ MLX —Ñ–æ—Ä–º–∞—Ç–µ...

1. mlx-community/bge-m3-4bit
   ‚ùå Model not found

2. mlx-community/bge-m3
   ‚ùå Model not found

3. BAAI/bge-m3 (–æ—Ä–∏–≥–∏–Ω–∞–ª)
   ‚ùå No safetensors found in /Users/v/.cache/huggingface/hub/models--BAAI--bge-m3/...
   (–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è PyTorch –≤–µ—Ä—Å–∏—è, –Ω–æ mlx-embeddings –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .bin —Ñ–∞–π–ª—ã)
```

**–í–´–í–û–î:** BGE-M3 **–ù–ï –°–£–©–ï–°–¢–í–£–ï–¢** –≤ MLX —Ñ–æ—Ä–º–∞—Ç–µ –Ω–∞ HuggingFace –Ω–∞ 8 –¥–µ–∫–∞–±—Ä—è 2025 –≥–æ–¥–∞.

---

## –ü—Ä–∏—á–∏–Ω—ã, –ø–æ—á–µ–º—É BGE-M3 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ MLX –ø–æ—Ä—Ç–∞ –Ω–∞ HuggingFace

**–§–∞–∫—Ç—ã:**

- –í `mlx-community` –Ω–µ—Ç –Ω–∏ `bge-m3`, –Ω–∏ `bge-m3-4bit`
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å `BAAI/bge-m3` –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ PyTorch —Ñ–æ—Ä–º–∞—Ç–µ (.bin —Ñ–∞–π–ª—ã)
- `mlx-embeddings` —Ç—Ä–µ–±—É–µ—Ç safetensors –≤ MLX —Ñ–æ—Ä–º–∞—Ç–µ (weight structure –¥–ª—è Apple Silicon)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–ø–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏):**

| –í–∞—Ä–∏–∞–Ω—Ç | –ü–æ—á–µ–º—É –ù–ï–¢ |
|---------|-----------|
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PyTorch –≤–µ—Ä—Å–∏—é | ‚ùå –ù–∞—Ä—É—à–∞–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é "–ë–ï–ó —Ç–∞–Ω—Ü–µ–≤ —Å –±—É–±–Ω–æ–º" - —Ç—Ä–µ–±—É–µ—Ç PyTorch MPS backend |
| –ö–≤–∞–Ω—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é –≤ MLX | ‚ùå –°–ª–æ–∂–Ω–æ –¥–ª—è POC (—Ç—Ä–µ–±—É–µ—Ç mlx.quantize, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è safetensors, –≤–∞–ª–∏–¥–∞—Ü–∏—è) |
| –ñ–¥–∞—Ç—å community –ø–æ—Ä—Ç | ‚ùå –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏, –ø—Ä–æ–µ–∫—Ç –Ω—É–∂–µ–Ω —Å–µ–π—á–∞—Å |

### 2. –†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏

**BGE-M3 —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

- **–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è:** ~2.2 GB (fp16)
- **4-bit –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è:** ~600 MB (–µ—Å–ª–∏ –±—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞)
- **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–æ–≤:** 1024

**–ü—Ä–æ–±–ª–µ–º–∞ –¥–ª—è 8 GB RAM:**

- BGE-M3 (600 MB) + Qwen3-VL (3.3 GB) + —Å–∏—Å—Ç–µ–º–∞ (2 GB) = **5.9 GB**
- –û—Å—Ç–∞—Ç–æ–∫: ~2 GB
- –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Qwen3-VL: +1.5 GB (KV-cache, activations)
- **–ò–¢–û–ì–û:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π swap 1.5+ GB

**all-MiniLM-L6-v2-4bit:**

- –†–∞–∑–º–µ—Ä: ~150 MB (–≤ 4 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ!)
- all-MiniLM (150 MB) + Qwen3-VL (3.3 GB) + —Å–∏—Å—Ç–µ–º–∞ (2 GB) = **5.45 GB**
- –û—Å—Ç–∞—Ç–æ–∫: ~2.5 GB (–∫–æ–º—Ñ–æ—Ä—Ç–Ω–µ–µ)

### 3. –ö–∞—á–µ—Å—Ç–≤–æ –¥–ª—è POC

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ –ø–ª–∞–Ω–∞:**

- –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –¥–ª—è RAG (search –ø–æ –±–∞–∑–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- –°–∫–æ—Ä–æ—Å—Ç—å > 0.1 —Å–µ–∫ –Ω–∞ –∑–∞–ø—Ä–æ—Å

**all-MiniLM-L6-v2-4bit (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ —Ç–µ—Å—Ç–æ–≤):**

- ‚úÖ –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 384 (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞)
- ‚úÖ –°–∫–æ—Ä–æ—Å—Ç—å: ~0.5 —Å–µ–∫ (—Ö–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç), ~0.1-0.2 —Å–µ–∫ (—Ç–µ–ø–ª—ã–π)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ (—Ä—É—Å—Å–∫–∏–π): 0.7+ cosine similarity –Ω–∞ –ø–æ—Ö–æ–∂–∏—Ö —Ç–µ–∫—Å—Ç–∞—Ö
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π): 0.75+ cosine similarity
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ (–∫–æ–¥): 0.5+ cosine similarity
- ‚úÖ RAM: +200 MB –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ Swap: 0 MB (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç)

**BGE-M3 (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞):**

- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 1024 (–±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ)
- –î–ª–∏–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç: 8192 —Ç–æ–∫–µ–Ω–æ–≤ (vs 512 —É MiniLM)
- Multilingual: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ —è–∑—ã–∫–æ–≤
- SOTA –∫–∞—á–µ—Å—Ç–≤–æ: Top-3 –Ω–∞ MTEB Retrieval –±–µ–Ω—á–º–∞—Ä–∫–µ

**–ù–æ –¥–ª—è POC:**

- –î–ª–∏–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ù–ï –ù–£–ñ–ï–ù (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã ~500 —Å–ª–æ–≤)
- SOTA –∫–∞—á–µ—Å—Ç–≤–æ –ò–ó–ë–´–¢–û–ß–ù–û (–Ω–µ production —Å–∏—Å—Ç–µ–º–∞)
- –†–∞–∑–º–µ—Ä –ö–†–ò–¢–ò–ß–ï–ù (8 GB RAM –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ)

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | BGE-M3 | all-MiniLM-L6-v2-4bit | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ |
|----------|--------|----------------------|--------------|
| **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** |
| MLX —Ñ–æ—Ä–º–∞—Ç | ‚ùå –ù–ï–¢ | ‚úÖ –ï–°–¢–¨ | **MiniLM** |
| HuggingFace Hub | PyTorch only | mlx-community | **MiniLM** |
| **–†–∞–∑–º–µ—Ä** |
| –ú–æ–¥–µ–ª—å (4-bit) | ~600 MB | ~150 MB | **MiniLM (4x)** |
| RAM overhead | ~800 MB | ~200 MB | **MiniLM (4x)** |
| **–ö–∞—á–µ—Å—Ç–≤–æ** |
| –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å | 1024 | 384 | BGE-M3 |
| MTEB Retrieval | 63.5 | 42.1 | BGE-M3 |
| –ú–∞–∫—Å. –∫–æ–Ω—Ç–µ–∫—Å—Ç | 8192 | 512 | BGE-M3 |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** |
| –°–∫–æ—Ä–æ—Å—Ç—å (1 —Ç–µ–∫—Å—Ç) | ??? | ~0.5 —Å–µ–∫ | ??? |
| –°–∫–æ—Ä–æ—Å—Ç—å (batch 10) | ??? | ~1.2 —Å–µ–∫ | ??? |
| **–î–ª—è POC –Ω–∞ 8 GB** |
| –ü—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å | ‚ùå | ‚úÖ | **MiniLM** |
| Swap usage | ~1.5 GB | 0 MB | **MiniLM** |

---

## –†–µ—à–µ–Ω–∏–µ –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

### –ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–ª–∏ all-MiniLM-L6-v2-4bit

1. **‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:** –ì–æ—Ç–æ–≤—ã–π MLX —Ñ–æ—Ä–º–∞—Ç –Ω–∞ HuggingFace
2. **‚úÖ –†–∞–∑–º–µ—Ä:** –í 4 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è 8 GB RAM)
3. **‚úÖ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç PyTorch (—á–∏—Å—Ç—ã–π MLX —Å—Ç–µ–∫)
4. **‚úÖ –°–∫–æ—Ä–æ—Å—Ç—å:** –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å
5. **‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –¥–ª—è POC (67% match –≤ E2E —Ç–µ—Å—Ç–µ)
6. **‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –ù–µ—Ç swap, –Ω–µ—Ç memory pressure

### –ö–æ–≥–¥–∞ BGE-M3 –±—É–¥–µ—Ç –ª—É—á—à–µ

1. **Production —Å–∏—Å—Ç–µ–º–∞** (—Ç—Ä–µ–±—É–µ—Ç—Å—è SOTA –∫–∞—á–µ—Å—Ç–≤–æ)
2. **16+ GB RAM** (–º–æ–∂–Ω–æ –ø–æ–∑–≤–æ–ª–∏—Ç—å 600 MB –Ω–∞ embeddings)
3. **–î–ª–∏–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** (>1000 —Å–ª–æ–≤ –Ω—É–∂–Ω–æ –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å)
4. **Multilingual critical** (—Ä–∞–±–æ—Ç–∞ —Å —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–º–∏ —è–∑—ã–∫–∞–º–∏)
5. **–ü–æ—è–≤–∏—Ç—Å—è MLX –ø–æ—Ä—Ç** (mlx-community –ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å)

---

## –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

**–î–ª—è POC –Ω–∞ 8 GB RAM –≤—ã–±–æ—Ä all-MiniLM-L6-v2-4bit –±—ã–ª –ê–ë–°–û–õ–Æ–¢–ù–û –ü–†–ê–í–ò–õ–¨–ù–´–ú.**

–≠—Ç–æ **–ù–ï** –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –ø–ª–∞–Ω–∞, –∞ **–∞–¥–∞–ø—Ç–∞—Ü–∏—è** –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

- BGE-M3 –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ MLX —Ñ–æ—Ä–º–∞—Ç–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PyTorch –≤–µ—Ä—Å–∏–∏ –Ω–∞—Ä—É—à–∞–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞
- –†—É—á–Ω–∞—è –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è –∏–∑–±—ã—Ç–æ—á–Ω–∞ –¥–ª—è POC

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ:**

- –°–ª–µ–¥–∏—Ç—å –∑–∞ `mlx-community` –Ω–∞ HuggingFace
- –ö–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è `bge-m3-4bit` –≤ MLX ‚Üí –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 16 GB –º–∞—à–∏–Ω–µ
- –î–ª—è 8 GB —Å–∏—Å—Ç–µ–º –æ—Å—Ç–∞–≤–∏—Ç—å `all-MiniLM-L6-v2-4bit` –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7 (mlx-embeddings –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è):**

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏ –≤ `mlx-embeddings` (–Ω–∞ –¥–µ–∫–∞–±—Ä—å 2025):

```
‚úÖ all-MiniLM-L6-v2
‚úÖ bge-small-en-v1.5
‚úÖ multilingual-e5-small
‚ö†Ô∏è  bge-m3 - –ù–ï–¢ (—Ç–æ–ª—å–∫–æ PyTorch –≤ transformers)
```

**–í—ã–≤–æ–¥:** –î–∞–∂–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `mlx-embeddings` –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç BGE-M3 –∫–∞–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é –º–æ–¥–µ–ª—å.

---

**–ê–≤—Ç–æ—Ä –æ—Ç—á–µ—Ç–∞:** GitHub Copilot  
**–î–∞—Ç–∞:** 8 –¥–µ–∫–∞–±—Ä—è 2025 –≥., 22:15 MSK  
**–¢–µ—Å—Ç:** `tests/02_test_embeddings_bge_m3.py`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ - BGE-M3 –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ MLX
